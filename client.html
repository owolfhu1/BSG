<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>test test</title>

    <!-- socket io -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- socket io -->

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <!-- jquery -->

    <!-- bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/darkly/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- bootstrap -->

    <style>
        #game_body{
            height:475px;
            width:800px;
            overflow: scroll;
        }
        #main_board{
            height:1525px;
            width:1750px;
            background-image: url("BSG_board.jpg");
            background-size: 1750px 1525px;
            position:relative;
        }
        #hand_container{
            height:150px;
            width:800px;
            overflow: scroll;
        }
        #player_hand{
            height:300px;
            width:2000px;
            overflow: scroll;
        }


        .text-display{
            height: 250px;
            overflow-y: scroll;
        }

        .border{
            border : solid black 1px;
            border-radius: 10px;
        }

        #fuelCounter{

        }

    </style>

</head>
<body>
<div class="container">
    <div class="row">

        <br/>
        <br/>

        <div id="online" style="display: none">
            <!-- text area -->
            <div class="col-sm-4">
                <!-- game data -->
                <div id="game_data" class="well text-display">
                    <!-- game data from server goes here -->
                </div>
                <!-- game data -->
                <!-- game input -->
                <input id="game_input" type="text" class="form-control" placeholder="enter game commands here"/>
                <!-- game input -->
                <br/>
                <!-- chat -->
                <div id="chat" class="well text-display">
                    <!-- chat from server goes here -->
                </div>
                <!-- chat -->
                <!-- chat input -->
                <input id="chat_input" type="text" class="form-control" placeholder="chat here"/>
                <!-- chat input -->
            </div>
            <!-- text area -->
        </div>

        <!-- body-->
        <div class="col-sm-8">
            <div id="game_body" class="well">
                <br/>
                <br/>
                <br/>
                <br/>
                <input id="username" type="text" placeholder="username" class="form-control"/>
                <br/>
                <button id="login" class="btn btn-success btn-lg btn-block">log in</button>
            </div>
            <div id='hand_container'><div id='player_hand'></div></div>
        </div>
        <!-- body -->

        <!--  -->

    </div>
</div>

<script>

    let socket = io();
    let name = 'error';
    let chat = document.getElementById('chat');
    let chat_input = document.getElementById('chat_input');
    let game_body = document.getElementById('game_body');
    let online = document.getElementById('online');
    let username = document.getElementById('username');
    let login = document.getElementById('login');
    let game_input = document.getElementById('game_input');
    let game_data = document.getElementById('game_data');
    //let something = document.getElementById('something');

    //receives chat and game_text from server and prints it in chat div
    socket.on('chat', text => {
        chat.innerHTML += text;
        chat.scrollTop = chat.scrollHeight;
    });
    socket.on('game_text', text => {
        game_data.innerHTML += text;
        game_data.scrollTop = game_data.scrollHeight;
    });

    //sends chat when enter is pressed in chat input
    chat_input.addEventListener('keyup', event => {
        event.preventDefault();
        if (event.keyCode === 13) {
            let text = chat_input.value;
            chat_input.value = '';
            socket.emit('chat', `${name}: ${text}</p>`);
        }
    });
    game_input.addEventListener('keyup', event => {
        event.preventDefault();
        if (event.keyCode === 13) {
            let text = game_input.value;
            game_input.value = '';
            socket.emit('game_text', text);
        }
    });

    //attempts to login on click
    login.addEventListener('click', () => {
        if (username.value.split(' ').length === 1 && username.value !== '' && username.value.length < 15)
            socket.emit('login', username.value);
    });

    //what to do when server says login
    socket.on('login', loginName => {
        name = loginName;
        online.style.display = 'inherit';
        game_body.innerHTML = "";
    });

    socket.on('lobby', tables => {
        let tablesHTML = `
            <button id="new_table" class="btn btn-lg btn-success btn-block">
                Click here to start a new table
            </button><br/><br/>
        `;
        //make a well for each table with basic info and a button to join it.
        for (let key in tables) {
            let players = '';
            for (let x = 0; x < tables[key].players.length; x++){
                players += `${x + 1}) ${tables[key].players[x].username} <br/>`;
            }
            tablesHTML += `
                <div class="well border">
                    <h1>${tables[key].host}'s table</h1>
                    ${players}
                    <button id="${tables[key].host}" class="btn btn-lg btn-primary btn-block">join table</button>
                </div>
            `;
        }
        game_body.innerHTML = tablesHTML;
        //activate join buttons
        for (let key in tables)
            $(`#${tables[key].host}`).click(() => socket.emit('join_table', key));
        //activate new table button
        $('#new_table').click(() => socket.emit('new_table'));
    });

    socket.on('table', table => {
        let tableHTML = `
            <h1>Welcome to ${table.host}'s table!</h1>
        `;
        //for each player at the table, print the name and if it
        //is the player using the client make a button else display if they are ready or not
        let players = '';
        for (let x = 0; x < table.players.length; x++) {
            players += `${x + 1}) ${table.players[x].username} : `;
            if (table.players[x].ready)
                players += `${name === table.players[x].username ?
                    `<button id="ready" class="btn btn-xs btn-default">ready</button>` : `ready`}`;
            else
                players += `${name === table.players[x].username ?
                    `<button id="ready" class="btn btn-xs btn-default">not ready</button>` : `not ready`}`;
            players += '<br/>';
        }
        tableHTML += players;
        game_body.innerHTML = tableHTML;

        $('#ready').click(() => socket.emit('ready'));

    });

    socket.on('clear', () => game_body.innerHTML = "<div id='main_board'></div>");

    socket.on('gameState', gameState => {
        gameState=JSON.parse(gameState);
        let main_board = document.getElementById('main_board');
        let board="<div id='main_board'>";
        board+="<div id=\"fuelCounter\" style=\"position:absolute;height:164px;width:164px;left:877px;top:23px;background-size:164px 164px;background-image:url('fuel"+gameState['fuelAmount']+".png');\"></div>";
        board+="<div id=\"foodCounter\" style=\"position:absolute;height:164px;width:164px;left:1047px;top:23px;background-size:164px 164px;background-image:url('fuel"+gameState['foodAmount']+".png');\"></div>";
        board+="<div id=\"moraleCounter\" style=\"position:absolute;height:164px;width:164px;left:1217px;top:25px;background-size:164px 164px;background-image:url('fuel"+gameState['moraleAmount']+".png');\"></div>";
        board+="<div id=\"populationCounter\" style=\"position:absolute;height:164px;width:164px;left:1390px;top:25px;background-size:164px 164px;background-image:url('fuel"+gameState['populationAmount']+".png');\"></div>";
        for(let i=0;i<gameState['raptorsInHangar'];i++){
            board+="<div class=\"raptor\" style=\"position:absolute;height:31px;width:50px;left:"+(570+(i*55))+"px;top:50px;background-size:50px 31px;background-image:url('BSG_Raptor.png');\"></div>";
        }
        for(let i=0;i<Math.min(gameState['vipersInHangar'],4);i++){
            board+="<div class=\"viper\" style=\"position:absolute;height:23px;width:46px;left:"+(575+(i*50))+"px;top:100px;background-size:46px 23px;background-image:url('Viper.png');\"></div>";
        }
        for(let i=0;i<Math.min(gameState['vipersInHangar']-4,8);i++){
            board+="<div class=\"viper\" style=\"position:absolute;height:23px;width:46px;left:"+(575+(i*50))+"px;top:150px;background-size:46px 23px;background-image:url('Viper.png');\"></div>";
        }
        for(let i=0;i<4;i++){
            for(let j=0;j<Math.min(gameState['damagedVipers']-(2*i),2);i++) {
                board += "<div class=\"viper\" style=\"position:absolute;height:23px;width:46px;left:" + (355 + (j * 50)) + "px;top:"+(50 + (i * 50))+";background-size:46px 23px;background-image:url('Viper.png');\"></div>";
            }
        }
        for(let i=0;i<gameState['centurionTrack'].length;i++){
            for(let j=0;j<gameState['centurionTrack'][i];j++) {
                board += "<div class=\"centurion\" style=\"position:absolute;height:78px;width:50px;left:"+(1292 + (i * 42))+"px;top:"+(325 + (j * 10))+"px;background-size:50px 78px;background-image:url('BSG_Boarding_Party.png');\"></div>";
            }
        }

        board+="</div>";
        game_body.innerHTML = board;
    });

</script>


</body>
</html>











